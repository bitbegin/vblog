(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{393:function(a,e,s){"use strict";s.r(e);var t=s(5),d=Object(t.a)({},(function(){var a=this,e=a._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("p",[a._v("隔离见证hash算法文档： "),e("code",[a._v("https://github.com/bitcoin/bips/blob/master/bip-0143.mediawiki")])]),a._v(" "),e("h1",{attrs:{id:"数据组成"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据组成"}},[a._v("#")]),a._v(" 数据组成")]),a._v(" "),e("h2",{attrs:{id:"公钥"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#公钥"}},[a._v("#")]),a._v(" 公钥")]),a._v(" "),e("p",[a._v("未压缩公钥："),e("code",[a._v("04 + X(32B) + Y(32B)")]),a._v("\n隔离见证需要的公钥为："),e("code",[a._v("03 + X(32B)")]),a._v("或者 "),e("code",[a._v("02 + Y(32B)")])]),a._v(" "),e("h2",{attrs:{id:"hash算法"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash算法"}},[a._v("#")]),a._v(" hash算法")]),a._v(" "),e("h3",{attrs:{id:"double-sha256-dsha256"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#double-sha256-dsha256"}},[a._v("#")]),a._v(" double sha256 (dSHA256)")]),a._v(" "),e("ul",[e("li",[a._v("tx id\nid = sha256(sha256(data)) = dSHA256(data)\n长度为32字节")]),a._v(" "),e("li",[a._v("address checksum")])]),a._v(" "),e("h3",{attrs:{id:"hash160"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash160"}},[a._v("#")]),a._v(" hash160")]),a._v(" "),e("p",[a._v("hash160(data) = ripemd160(sha256(data))")]),a._v(" "),e("h2",{attrs:{id:"address-pubkey-to-addr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#address-pubkey-to-addr"}},[a._v("#")]),a._v(" address (pubkey-to-addr)")]),a._v(" "),e("blockquote",[e("blockquote",[e("p",[a._v("prefix: https://en.bitcoin.it/wiki/List_of_address_prefixes")])])]),a._v(" "),e("h3",{attrs:{id:"legacy-address-pubkey-to-legacy-addr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#legacy-address-pubkey-to-legacy-addr"}},[a._v("#")]),a._v(" legacy address (pubkey-to-legacy-addr)")]),a._v(" "),e("p",[a._v("pubkey-hash = hash160(pubkey)\nscript-pubkey = prefix + pubkey-hash\nencode58-check(data) = encode58(data + dSHA256(data)[0..3])\naddress = encode58-check(script-pubkey)")]),a._v(" "),e("h3",{attrs:{id:"segwit-address-pubkey-to-segwit-addr"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#segwit-address-pubkey-to-segwit-addr"}},[a._v("#")]),a._v(" segwit address (pubkey-to-segwit-addr)")]),a._v(" "),e("p",[a._v("pubkey-hash = hash160(pubkey)\nredeemScript = 0014 + pubkey-hash\npubkey-to-addr(redeemScript)")]),a._v(" "),e("h1",{attrs:{id:"hash计算过程"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#hash计算过程"}},[a._v("#")]),a._v(" hash计算过程")]),a._v(" "),e("p",[a._v("要解析的交易id： "),e("code",[a._v("fc2344f6c98cc19e5b3d7b716f9eaaeb21ab781393731652c710afd07a5505bf")]),a._v("\n原始数据内容参考：\n"),e("code",[a._v("https://tchain.btc.com/fc2344f6c98cc19e5b3d7b716f9eaaeb21ab781393731652c710afd07a5505bf.rawhex")])]),a._v(" "),e("h2",{attrs:{id:"组装-未签名-交易数据"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#组装-未签名-交易数据"}},[a._v("#")]),a._v(" 组装 未签名 交易数据")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("nVersion:      01000000\ntxin:              03 373d0980f9293fc5864c02fa7946ab706a1f0a5c5aedb8ee3a7eaf4d17c65e5e 01000000 00 ffffff00\n                          df618d78879c213bde156e3ee55d1abe1badf750828aa0587d4a6d7fd2a41df7 00000000 00 ffffff00\n                          df618d78879c213bde156e3ee55d1abe1badf750828aa0587d4a6d7fd2a41df7 01000000 00 ffffff00\ntxout:           02 0084d71700000000 17a9145be3eb3165f9c7ad58d3f49dc7f253ac42499eef87\n                          ebd4f20300000000 17a91481dd877be5b3b60e3b1ccf547785744345570b9387\nnLockTime: 00000000\n")])])]),e("p",[a._v("UTXO = 373d0980f9293fc5864c02fa7946ab706a1f0a5c5aedb8ee3a7eaf4d17c65e5e\nUTXO-INDEX = 01000000")]),a._v(" "),e("p",[a._v("OUT-VALUE = 0084d71700000000\nOUT-SCRIPT = 17a9145be3eb3165f9c7ad58d3f49dc7f253ac42499eef87")]),a._v(" "),e("h2",{attrs:{id:"计算hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#计算hash"}},[a._v("#")]),a._v(" 计算hash")]),a._v(" "),e("h3",{attrs:{id:"计算-input-hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#计算-input-hash"}},[a._v("#")]),a._v(" 计算 input hash")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("hashPrevouts = dSHA256([UTXO + UTXO-INDEX] * n)\n    = dSHA256(373d0980f9293fc5864c02fa7946ab706a1f0a5c5aedb8ee3a7eaf4d17c65e5e 01000000 \n                     df618d78879c213bde156e3ee55d1abe1badf750828aa0587d4a6d7fd2a41df7 00000000\n                     df618d78879c213bde156e3ee55d1abe1badf750828aa0587d4a6d7fd2a41df7  01000000)\n     = 6a59d58aabff920acf810aeca6359dbad8f0e07d9baa1dfdea7880843d44de72\n")])])]),e("h3",{attrs:{id:"计算-sequence-hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#计算-sequence-hash"}},[a._v("#")]),a._v(" 计算 sequence hash")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("hashSequence = dSHA256([sequence] * n)\n    = dSHA256(01000000 00000000 01000000)\n    = 89974e58642dbbe1948159e6134c0b1f5b079893ab61cf02417f490cab69e052\n")])])]),e("h3",{attrs:{id:"计算-output-hash"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#计算-output-hash"}},[a._v("#")]),a._v(" 计算 output hash")]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("hashOutputs =  dSHA256([OUT-VALUE + OUT-SCRIPT] * n)\n    = dSHA256(0084d71700000000 17a9145be3eb3165f9c7ad58d3f49dc7f253ac42499eef87\n                         ebd4f20300000000 17a91481dd877be5b3b60e3b1ccf547785744345570b9387)\n    = 7162a64cfdd10579b3f3a33e73ae59213588794724897d6cfa18f3ccce398b7c\n")])])]),e("h3",{attrs:{id:"计算-hash-preimage-for-input-1"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#计算-hash-preimage-for-input-1"}},[a._v("#")]),a._v(" 计算 hash preimage (for input 1)")]),a._v(" "),e("blockquote",[e("blockquote",[e("p",[a._v("For P2WPKH witness program, the scriptCode is 0x1976a914{20-byte-pubkey-hash}88ac")])])]),a._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[a._v("hash preimage = \n      nVersion:             01000000\n      hashPrevouts:     6a59d58aabff920acf810aeca6359dbad8f0e07d9baa1dfdea7880843d44de72\n      hashSequence:   89974e58642dbbe1948159e6134c0b1f5b079893ab61cf02417f490cab69e052\n      outpoint:             373d0980f9293fc5864c02fa7946ab706a1f0a5c5aedb8ee3a7eaf4d17c65e5e 01000000\n      scriptCode:          1976a914 {} 88ac\n      amount:               {input amount}\n      nSequence:         ffffff00\n      hashOutputs:      7162a64cfdd10579b3f3a33e73ae59213588794724897d6cfa18f3ccce398b7c\n      nLockTime:         00000000\n      nHashType:         01000000\n")])])]),e("p",[a._v("sigHash = dSHA256(hash preimage)")]),a._v(" "),e("Vssue",{attrs:{title:a.$title}})],1)}),[],!1,null,null,null);e.default=d.exports}}]);